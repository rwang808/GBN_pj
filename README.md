# GBN协议实现项目

## 项目概述

本项目实现了基于UDP的可靠数据传输协议，包括：
- **GBN (Go-Back-N)** 协议：滑动窗口协议，支持累积确认和超时重传
- **网络丢包模拟器**：用于测试协议在不可靠网络环境下的表现
- **综合测试工具**：验证协议的正确性和性能

## 项目结构

```
GBN/
├── gbn_server.py              # GBN协议服务器端实现
├── gbn_client.py              # GBN协议客户端实现
├── packet_loss_simulator.py   # 网络丢包模拟器
├── test_protocols.py          # 综合测试脚本
├── requirements.txt           # 项目依赖
└── README.md                  # 项目文档
```

## 核心功能

### 1. GBN (Go-Back-N) 协议

**特点：**
- 发送端维护滑动窗口
- 累积确认机制
- 超时重传所有未确认数据包
- 接收端只接受按序到达的数据包

**主要类：**
- `GBNServer`: 服务器端，处理客户端数据并发送ACK
- `GBNClient`: 客户端，实现滑动窗口和超时重传


**主要类：**

### 3. 网络丢包模拟器

**功能：**
- 模拟网络丢包环境
- 可配置丢包率和延迟
- 提供统计信息
- 支持协议性能对比测试

## 快速开始

### 环境要求

- Python 3.7+
- 无需额外依赖（使用Python标准库）

### 基本使用

#### 1. 测试GBN协议

**启动服务器：**
```bash
python gbn_server.py
```

**启动客户端：**
```bash
python gbn_client.py
```


#### 3. 运行综合测试

```bash
python test_protocols.py
```

选择相应的测试项目：
- 1: 测试GBN协议
- 3: 测试文件传输
- 4: 测试网络丢包环境
- 5: 运行综合测试
- 6: 启动丢包模拟器

#### 4. 启动丢包模拟器

```bash
python packet_loss_simulator.py
```

## 协议实现原理

### GBN协议工作流程

1. **发送端：**
   - 维护发送窗口 [base, base+N-1]
   - 发送窗口内的所有数据包
   - 启动定时器，等待ACK
   - 收到ACK时，滑动窗口
   - 超时时，重传所有未确认数据包

2. **接收端：**
   - 维护期望序号
   - 只接受按序到达的数据包
   - 发送累积ACK
   - 丢弃乱序数据包


## 数据包格式

```
+----------+----------+----------+----------+
| seq_num  | is_ack   | data_len |   data   |
| (4字节)  | (1字节)  | (4字节)  | (变长)   |
+----------+----------+----------+----------+
```

- `seq_num`: 序列号
- `is_ack`: ACK标志位
- `data_len`: 数据长度
- `data`: 实际数据

## 配置参数

### GBN协议参数

```python
server = GBNServer(
    host='localhost',     # 服务器地址
    port=8888,           # 服务器端口
    window_size=4,       # 窗口大小
    timeout=2.0          # 超时时间(秒)
)

client = GBNClient(
    server_host='localhost',  # 服务器地址
    server_port=8888,        # 服务器端口
    window_size=4,           # 窗口大小
    timeout=2.0              # 超时时间(秒)
)
```


### 丢包模拟器参数

```python
simulator = PacketLossSimulator(
    client_port=8887,              # 客户端连接端口
    server_host='localhost',       # 服务器地址
    server_port=8888,             # 服务器端口
    loss_rate=0.2,                # 丢包率 (0.0-1.0)
    delay_range=(0.1, 0.5)        # 延迟范围(秒)
)
```

## 测试结果示例

### 协议性能对比

```
=== 测试报告 ===
协议    丢包率  消息数  传输时间(s)  效率
--------------------------------------------------
GBN     10%     8       3.45        2.32
GBN     20%     8       4.12        1.94
GBN     30%     8       5.23        1.53
SR      10%     8       2.87        2.79
SR      20%     8       3.21        2.49
SR      30%     8       3.98        2.01

=== 分析结果 ===
GBN平均传输时间: 4.27秒
SR平均传输时间: 3.35秒
GBN协议性能测试完成
```

## 扩展功能

### 1. 拥塞控制

可以在现有基础上添加拥塞控制机制：
- 慢启动
- 拥塞避免
- 快速重传
- 快速恢复

### 2. 流量控制

实现接收端窗口通告：
- 动态调整发送窗口大小
- 防止接收端缓冲区溢出

### 3. 错误检测

添加校验和机制：
- CRC校验
- 数据完整性验证

## 故障排除

### 常见问题

1. **端口被占用**
   ```
   OSError: [WinError 10048] 通常每个套接字地址只允许使用一次
   ```
   解决方案：更改端口号或等待端口释放

2. **连接超时**
   ```
   socket.timeout: timed out
   ```
   解决方案：检查网络连接，增加超时时间

3. **数据包丢失过多**
   ```
   传输时间过长或失败
   ```
   解决方案：降低丢包率，增加窗口大小

### 调试技巧

1. **启用详细日志**：修改代码中的print语句
2. **调整参数**：减小窗口大小和超时时间进行测试
3. **单步测试**：先测试无丢包环境，再逐步增加丢包率

## 项目特色

1. **完整实现**：包含GBN和SR两种协议的完整实现
2. **模块化设计**：各组件独立，易于扩展和修改
3. **丢包模拟**：内置网络环境模拟器，便于测试
4. **性能对比**：提供详细的性能测试和分析工具
5. **文档完善**：详细的代码注释和使用说明

## 学习价值

通过本项目，可以深入理解：
- 可靠数据传输的基本原理
- 滑动窗口协议的工作机制
- 超时重传和确认机制
- 网络协议的性能分析方法
- Python网络编程和多线程编程

